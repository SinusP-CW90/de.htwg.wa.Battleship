var playgroundSize=4;let player1ShipCount=playgroundSize,shootPlayer2Count=0,player1Ship="shipRed",progressBarWidth=0;function startGame(){$("#gameContainer").show(),$("#startButton").hide(),$("#shipChoose").hide(),$("#infoText").addClass("intro"),$("#infoText").html("<b>Player 1 - please set "+player1ShipCount+" ships on your left side!</b>"),ValidateForm()}function ValidateForm(){let e=document.getElementsByName("vbtn-radio");for(let t=0;t<e.length;t++)1==e[t].checked&&(player1Ship=e[t].value,console.log("You have selected "+e[t].value+" as your favorite ship."))}function setOwnShips(){setCell("l",this.firstElementChild.getAttribute("cellValueIndex"),1),this.firstElementChild.innerHTML="<img src='http://localhost:9000/assets/images/"+player1Ship+".png' alt='S' class='gameContainer' id=this.value/>",this.firstElementChild.setAttribute("shoot","shipIsSet"),player1ShipCount-=1,$("#infoText").html("Player 1 - please set "+player1ShipCount+" ships on your left side!"),player1ShipCount<=0&&phase2()}function setRandomPlayer2Ships(){for(let e=0;e<playgroundSize;e++){let t="#cellRightValue-R"+e+"-C"+Math.floor(4*Math.random());$(t).addClass("shipIsSet"),$(t).html("<img src='http://localhost:9000/assets/images/pirateShip.png' alt='S' class='gameContainer' id=this.value/>")}}function phase2(){setTimeout((function(){alert("You set all your Ships")}),1e3),setRandomPlayer2Ships(),$("#infoText").html="Player 1 - Now shoot Player2´s ships:\n you hit "+shootPlayer2Count+" already",removeLeftCellEvents(),$(".cellLeft").onmouseover=function(){this.style.backgroundColor="darkred"};for(let e=0;e<$(".cellRight").length;e++)$(".cellRight")[e].addEventListener("click",shoot,!1)}function shoot(){if(console.log("in shoot) this.firstChild is: "+this.firstElementChild.classList.value),"number shipIsSet"===this.firstElementChild.classList.value)this.firstElementChild.innerHTML="<img src='http://localhost:9000/assets/images/pirateShipHit.png' alt='S' class='gameContainer' id=this.value/>",this.style.borderColor="red",shootPlayer2Count+=1,progressBarWidth+=25,document.getElementById("progressBar").style.width=progressBarWidth+"%",document.getElementById("infoText").innerHTML="Player 1 - Now shoot Player2´s ships:\nyou hit "+shootPlayer2Count+" already";else{this.firstElementChild.innerHTML="<img src='http://localhost:9000/assets/images/miss.png' alt='S' class='gameContainer' id=this.value/>";let e=this;setTimeout((function(){e.firstElementChild.innerHTML="<img src='http://localhost:9000/assets/images/missAfter.png' alt='S' class='gameContainer' id=this.value/>"}),1500),setTimeout((function(){e.firstElementChild.innerHTML="<img src='http://localhost:9000/assets/images/missAfterAfter.png' alt='S' class='gameContainer' id=this.value/>"}),3e3)}winCheck(),setTimeout((function(){shootRandomLeftShips()}),1500)}function winCheck(){shootPlayer2Count===playgroundSize&&(document.getElementById("infoText").innerHTML="Player 1 WON!!!!!!!!!!!!",setTimeout((function(){alert("You WON!!!")}),1e3))}function shootRandomLeftShips(){let e="cellLeftValue-R"+Math.floor(4*Math.random())+"-C"+Math.floor(4*Math.random());switch(document.getElementById(e).getAttribute("shoot")){case"shipIsSet":document.getElementById(e).setAttribute("shoot","hit"),document.getElementById(e).innerHTML="<img src='http://localhost:9000/assets/images/"+player1Ship+"Hit.png' alt='S' class='gameContainer' id=this.value/>",document.getElementById(e).parentElement.style.borderColor="red";break;case"hit":shootRandomLeftShips();break;case"miss":shootRandomLeftShips();break;case"":$("#"+e).parent().css("border-color","darkblue"),document.getElementById(e).setAttribute("shoot","miss"),document.getElementById(e).innerHTML="<img src='http://localhost:9000/assets/images/miss.png' alt='S' class='gameContainer' id=this.value/>",setTimeout((function(){document.getElementById(e).innerHTML="<img src='http://localhost:9000/assets/images/missAfter.png' alt='S' class='gameContainer' id=this.value/>"}),1500),setTimeout((function(){document.getElementById(e).innerHTML="<img src='http://localhost:9000/assets/images/missAfterAfter.png' alt='S' class='gameContainer' id=this.value/>"}),3e3);break;default:}}function addLeftCellEvents(){for(let e=0;e<$(".cellLeft").length;e++)$(".cellLeft")[e].addEventListener("click",setOwnShips,!1)}function removeLeftCellEvents(){for(let e=0;e<$(".cellLeft").length;e++)$(".cellLeft")[e].removeEventListener("click",setOwnShips,!1)}function indexTorRow(e){return Math.floor(e/playgroundSize)}function indexToCol(e){return Math.floor(e%playgroundSize)}function cellToIndex(e,t){return Math.floor(e*playgroundSize+t)}function setCell(e,t,l){let i;"l"===e&&(i="#cellLeftValue-R",battlefieldSide=battlefieldLeft),"r"===e&&(i="#cellRightValue-R",battlefieldSide=battlefieldRight),console.log("Set "+e+" json-cell "+t+" to "+l),battlefieldSide.cellvalue[t]=l,$(i+indexTorRow(t)+"-C"+indexToCol(t)).html(" "+battlefieldSide.cellvalue[t]),setCellOnServer(e,indexTorRow(t),indexToCol(t),l),$(i+indexTorRow(t)+"-C"+indexToCol(t)).off("click")}class Battlefield{constructor(e,t){this.side=e,this.size=t,this.cellvalue=[]}fill(e){for(let t=0;t<this.size*this.size;t++)console.log(e[t].cell.value),this.cellvalue[t]=e[t].cell.value}}let battlefieldLeft=new Battlefield("l",playgroundSize),battlefieldRight=new Battlefield("r",playgroundSize);function updateBattlefield(e,t){for(let l=0;l<playgroundSize;l++)for(let i=0;i<playgroundSize;i++)0!=t.cellvalue[cellToIndex(l,i)]&&(console.log("side: "+e+" - row: "+l+" | col :"+i+" has the value: "+t.cellvalue[cellToIndex(l,i)]),"l"===e&&1===t.cellvalue[cellToIndex(l,i)]&&(console.log("<img src='http://localhost:9000/assets/images/"+player1Ship+".png' alt='S' class='gameContainer' id=this.value"),$("#cellLeftValue-R"+l+"-C"+i).html("S"),$("#cellLeftValue-R"+l+"-C"+i).attr("shoot","shipIsSet")),"r"===e&&($("#cellRightValue-R"+l+"-C"+i).html(t.cellvalue[cellToIndex(l,i)]),t.cellvalue[cellToIndex(l,i)]))}function setCellOnServer(e,t,l,i){$.get("battleship/setL/"+t+"/"+l+"/"+i,(function(i){console.log("Set cell on side: "+e+" - row: "+t+" | col :"+l+" on Server")}))}function loadJson(){$.ajax({method:"GET",url:"battleship/json",dataType:"json",success:function(e){console.log("right: "+e.battlefield.rightSide.cells[0].cell.value),console.log("json - success"),console.log("playgroundSize: "+e.battlefield.leftSide.size),playgroundSize=e.battlefield.leftSide.size,player1ShipCount=e.battlefield.leftSide.size,battlefieldLeft=new Battlefield("l",e.battlefield.leftSide.size),battlefieldRight=new Battlefield("r",e.battlefield.rightSide.size),battlefieldLeft.fill(e.battlefield.leftSide.cells),battlefieldRight.fill(e.battlefield.rightSide.cells),updateBattlefield("l",battlefieldLeft),updateBattlefield("r",battlefieldRight),addLeftCellEvents(),document.getElementById("startButton").addEventListener("click",startGame,!1)}})}function connectWebSocket(){var e=new WebSocket("ws://localhost:9000/battleship/websocket");e.setTimeout,e.onopen=function(e){console.log("Connected to Websocket")},e.onclose=function(){console.log("Connection with Websocket Closed!")},e.onerror=function(e){console.log("Error in Websocket Occurred: "+e)},e.onmessage=function(e){if("string"===typeof e.data){let t=JSON.parse(e.data);battlefieldLeft.fill(t.battlefield.leftSide.cells),battlefieldRight.fill(t.battlefield.rightSide.cells),updateBattlefield("l",battlefieldLeft),updateBattlefield("r",battlefieldRight)}}}$(document).ready((function(){console.log("Document is ready, filling battlefield"),loadJson(),connectWebSocket(),$(gameContainer).hide()}));